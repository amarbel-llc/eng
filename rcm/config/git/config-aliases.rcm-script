#! /usr/bin/env -S bash -eo pipefail

aliases_dir="$HOME/eng/rcm/config/git/aliases"
nix build "${aliases_dir}" --out-link "${aliases_dir}/result" >&2

echo -n "# "
echo "vim: ft=gitconfig"
echo
echo "[alias]"

while IFS= read -r -d '' alias_script; do
  alias_name="$(basename "$alias_script")"
  printf "\t%s = ! %s\n" "$alias_name" "$alias_script"
done < <(find "$HOME/.config/git/aliases/" -type l -exec test -f {} \; -exec test -x {} \; -print0 | sort -z || kill $$)
