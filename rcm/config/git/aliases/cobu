#! /usr/bin/env -S bash -e
# @file cobu
# @brief create a branch with a `$USER-%Y-%m-%d` prefix and set upstream to default branch

# shellcheck disable=1091
TAP_DANCER_LIB="$(dirname "$(readlink -f "$0")")/result/share/tap-dancer/lib"
source "${TAP_DANCER_LIB}/load.bash"

branch="$USER-$(date +%Y-%m-%d)-${1:?usage: git cobu <suffix>}"
default_branch="${2:-$(git branch-get-default)}"

tap_plan 2

tap_run "create branch ${branch}" git checkout -b "$branch"
tap_run "set upstream to upstream/${default_branch}" git branch --set-upstream-to="upstream/$default_branch"
